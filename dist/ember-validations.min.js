// ==========================================================================
// Project:   Ember Validations
// Copyright: Copyright 2013 DockYard, LLC. and contributors.
// License:   Licensed under MIT license (see license.js)
// ==========================================================================


 // Version: 1.0.0.beta.1

// Copyright: Copyright 2013 DockYard, LLC. and contributors.
!function(){Ember.Validations=Ember.Namespace.create({VERSION:"1.0.0.beta.1"})}(),function(){Ember.Validations.messages={render:function(t,i){var s=new RegExp("{{(.*?)}}"),e="";return s.test(this.defaults[t])&&(e=s.exec(this.defaults[t])[1]),this.defaults[t].replace(s,i[e])},defaults:{inclusion:"is not included in the list",exclusion:"is reserved",invalid:"is invalid",confirmation:"doesn't match {{attribute}}",accepted:"must be accepted",empty:"can't be empty",blank:"can't be blank",present:"must be blank",tooLong:"is too long (maximum is {{count}} characters)",tooShort:"is too short (minimum is {{count}} characters)",wrongLength:"is the wrong length (should be {{count}} characters)",notANumber:"is not a number",notAnInteger:"must be an integer",greaterThan:"must be greater than {{count}}",greaterThanOrEqualTo:"must be greater than or equal to {{count}}",equalTo:"must be equal to {{count}}",lessThan:"must be less than {{count}}",lessThanOrEqualTo:"must be less than or equal to {{count}}",otherThan:"must be other than {{count}}",odd:"must be odd",even:"must be even"}}}(),function(){Ember.Validations.Errors=Ember.Object.extend({unknownProperty:function(t){return this.set(t,Ember.makeArray()),this.get(t)}})}(),function(){var t=Ember.Mixin.create({isValid:function(){return 0===this.get("validators").compact().filterBy("isValid",!1).get("length")}.property("validators.@each.isValid"),isInvalid:Ember.computed.not("isValid")}),i=function(t,s){var o=t.get(s);t.removeObserver(s,i),Ember.isArray(o)?t.validators.pushObject(e.create({model:t,property:s,contentBinding:"model."+s})):t.validators.pushObject(o)},s=function(t){var i=t.classify();return Ember.Validations.validators.local[i]||Ember.Validations.validators.remote[i]},e=Ember.ArrayProxy.extend(t,{validate:function(){return this._validate()},_validate:function(){var t=this.get("content").invoke("_validate").without(void 0);return Ember.RSVP.all(t)}.on("init"),validators:Ember.computed.alias("content")});Ember.Validations.Mixin=Ember.Mixin.create(t,{init:function(){this._super(),this.errors=Ember.Validations.Errors.create(),this._dependentValidationKeys={},this.validators=Ember.makeArray(),void 0===this.get("validations")&&(this.validations={}),this.buildValidators(),this.validators.forEach(function(t){t.addObserver("errors.[]",this,function(t){var i=Ember.makeArray();this.validators.forEach(function(s){s.property===t.property&&(i=i.concat(s.errors))},this),this.set("errors."+t.property,i)})},this)},buildValidators:function(){var t;for(t in this.validations)this.validations[t].constructor===Object?this.buildRuleValidator(t):this.buildObjectValidator(t)},buildRuleValidator:function(t){var i;for(i in this.validations[t])this.validations[t].hasOwnProperty(i)&&this.validators.pushObject(s(i).create({model:this,property:t,options:this.validations[t][i]}))},buildObjectValidator:function(t){Ember.isNone(this.get(t))?this.addObserver(t,this,i):i(this,t)},validate:function(){var t=this;return this._validate().then(function(i){var s=t.get("errors");return i.contains(!1)?Ember.RSVP.reject(s):s})},_validate:function(){var t=this.validators.invoke("_validate").without(void 0);return Ember.RSVP.all(t)}.on("init")})}(),function(){Ember.Validations.patterns=Ember.Namespace.create({numericality:/^(-|\+)?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d*)?$/,blank:/^\s*$/})}(),function(){Ember.Validations.validators=Ember.Namespace.create(),Ember.Validations.validators.local=Ember.Namespace.create(),Ember.Validations.validators.remote=Ember.Namespace.create()}(),function(){Ember.Validations.validators.Base=Ember.Object.extend({init:function(){this.set("errors",Ember.makeArray()),this._dependentValidationKeys=Ember.makeArray(),this.conditionals={"if":this.get("options.if"),unless:this.get("options.unless")},this.model.addObserver(this.property,this,this._validate)},addObserversForDependentValidationKeys:function(){this._dependentValidationKeys.forEach(function(t){this.model.addObserver(t,this,this._validate)},this)}.on("init"),pushDependentValidaionKeyToModel:function(){var t=this.get("model");void 0===t._dependentValidationKeys[this.property]&&(t._dependentValidationKeys[this.property]=Ember.makeArray()),t._dependentValidationKeys[this.property].addObjects(this._dependentValidationKeys)}.on("init"),call:function(){throw"Not implemented!"},unknownProperty:function(t){var i=this.get("model");return i?i.get(t):void 0},isValid:Ember.computed.empty("errors.[]"),validate:function(){var t=this;return this._validate().then(function(i){var s=t.get("model.errors");return i?s:Ember.RSVP.reject(s)})},_validate:function(){return this.errors.clear(),this.canValidate()&&this.call(),this.get("isValid")?Ember.RSVP.resolve(!0):Ember.RSVP.resolve(!1)}.on("init"),canValidate:function(){if("object"!=typeof this.conditionals)return!0;if(this.conditionals["if"]){if("function"==typeof this.conditionals["if"])return this.conditionals["if"](this.model,this.property);if("string"==typeof this.conditionals["if"])return"function"==typeof this.model[this.conditionals["if"]]?this.model[this.conditionals["if"]]():this.model.get(this.conditionals["if"])}else{if(!this.conditionals.unless)return!0;if("function"==typeof this.conditionals.unless)return!this.conditionals.unless(this.model,this.property);if("string"==typeof this.conditionals.unless)return"function"==typeof this.model[this.conditionals.unless]?!this.model[this.conditionals.unless]():!this.model.get(this.conditionals.unless)}}})}(),function(){Ember.Validations.validators.local.Absence=Ember.Validations.validators.Base.extend({init:function(){this._super(),this.options===!0&&this.set("options",{}),void 0===this.options.message&&this.set("options.message",Ember.Validations.messages.render("present",this.options))},call:function(){Ember.isEmpty(this.model.get(this.property))||this.errors.pushObject(this.options.message)}})}(),function(){Ember.Validations.validators.local.Acceptance=Ember.Validations.validators.Base.extend({init:function(){this._super(),this.options===!0&&this.set("options",{}),void 0===this.options.message&&this.set("options.message",Ember.Validations.messages.render("accepted",this.options))},call:function(){this.options.accept?this.model.get(this.property)!==this.options.accept&&this.errors.pushObject(this.options.message):"1"!==this.model.get(this.property)&&1!==this.model.get(this.property)&&this.model.get(this.property)!==!0&&this.errors.pushObject(this.options.message)}})}(),function(){Ember.Validations.validators.local.Confirmation=Ember.Validations.validators.Base.extend({init:function(){this.originalProperty=this.property,this.property=this.property+"Confirmation",this._super(),this._dependentValidationKeys.pushObject(this.originalProperty),this.options===!0&&(this.set("options",{attribute:this.originalProperty}),this.set("options",{message:Ember.Validations.messages.render("confirmation",this.options)}))},call:function(){this.model.get(this.originalProperty)!==this.model.get(this.property)&&this.errors.pushObject(this.options.message)}})}(),function(){Ember.Validations.validators.local.Exclusion=Ember.Validations.validators.Base.extend({init:function(){this._super(),this.options.constructor===Array&&this.set("options",{"in":this.options}),void 0===this.options.message&&this.set("options.message",Ember.Validations.messages.render("exclusion",this.options))},call:function(){var t,i;Ember.isEmpty(this.model.get(this.property))?void 0===this.options.allowBlank&&this.errors.pushObject(this.options.message):this.options["in"]?-1!==Ember.$.inArray(this.model.get(this.property),this.options["in"])&&this.errors.pushObject(this.options.message):this.options.range&&(t=this.options.range[0],i=this.options.range[1],this.model.get(this.property)>=t&&this.model.get(this.property)<=i&&this.errors.pushObject(this.options.message))}})}(),function(){Ember.Validations.validators.local.Format=Ember.Validations.validators.Base.extend({init:function(){this._super(),this.options.constructor===RegExp&&this.set("options",{"with":this.options}),void 0===this.options.message&&this.set("options.message",Ember.Validations.messages.render("invalid",this.options))},call:function(){Ember.isEmpty(this.model.get(this.property))?void 0===this.options.allowBlank&&this.errors.pushObject(this.options.message):this.options["with"]&&!this.options["with"].test(this.model.get(this.property))?this.errors.pushObject(this.options.message):this.options.without&&this.options.without.test(this.model.get(this.property))&&this.errors.pushObject(this.options.message)}})}(),function(){Ember.Validations.validators.local.Inclusion=Ember.Validations.validators.Base.extend({init:function(){this._super(),this.options.constructor===Array&&this.set("options",{"in":this.options}),void 0===this.options.message&&this.set("options.message",Ember.Validations.messages.render("inclusion",this.options))},call:function(){var t,i;Ember.isEmpty(this.model.get(this.property))?void 0===this.options.allowBlank&&this.errors.pushObject(this.options.message):this.options["in"]?-1===Ember.$.inArray(this.model.get(this.property),this.options["in"])&&this.errors.pushObject(this.options.message):this.options.range&&(t=this.options.range[0],i=this.options.range[1],(this.model.get(this.property)<t||this.model.get(this.property)>i)&&this.errors.pushObject(this.options.message))}})}(),function(){Ember.Validations.validators.local.Length=Ember.Validations.validators.Base.extend({init:function(){var t,i;for(this._super(),"number"==typeof this.options&&this.set("options",{is:this.options}),void 0===this.options.messages&&this.set("options.messages",{}),t=0;t<this.messageKeys().length;t++)i=this.messageKeys()[t],void 0!==this.options[i]&&this.options[i].constructor===String&&this.model.addObserver(this.options[i],this,this._validate);this.tokenizedLength=new Function("value",'return (value || "").'+(this.options.tokenizer||'split("")')+".length")},CHECKS:{is:"==",minimum:">=",maximum:"<="},MESSAGES:{is:"wrongLength",minimum:"tooShort",maximum:"tooLong"},getValue:function(t){return this.options[t].constructor===String?this.model.get(this.options[t])||0:this.options[t]},messageKeys:function(){return Object.keys(this.MESSAGES)},checkKeys:function(){return Object.keys(this.CHECKS)},renderMessageFor:function(t){var i,s={count:this.getValue(t)};for(i in this.options)s[i]=this.options[i];return this.options.messages[this.MESSAGES[t]]||Ember.Validations.messages.render(this.MESSAGES[t],s)},renderBlankMessage:function(){return this.options.is?this.renderMessageFor("is"):this.options.minimum?this.renderMessageFor("minimum"):void 0},call:function(){var t,i,s;if(Ember.isEmpty(this.model.get(this.property)))void 0===this.options.allowBlank&&(this.options.is||this.options.minimum)&&this.errors.pushObject(this.renderBlankMessage());else for(s in this.CHECKS)i=this.CHECKS[s],this.options[s]&&(t=new Function("return "+this.tokenizedLength(this.model.get(this.property))+" "+i+" "+this.getValue(s)),t()||this.errors.pushObject(this.renderMessageFor(s)))}})}(),function(){Ember.Validations.validators.local.Numericality=Ember.Validations.validators.Base.extend({init:function(){var t,i,s;for(this._super(),this.options===!0?this.options={}:this.options.constructor===String&&(s=this.options,this.options={},this.options[s]=!0),void 0===this.options.messages&&(this.options.messages={numericality:Ember.Validations.messages.render("notANumber",this.options)}),void 0!==this.options.onlyInteger&&void 0===this.options.messages.onlyInteger&&(this.options.messages.onlyInteger=Ember.Validations.messages.render("notAnInteger",this.options)),i=Object.keys(this.CHECKS).concat(["odd","even"]),t=0;t<i.length;t++)s=i[t],isNaN(this.options[s])&&this.model.addObserver(this.options[s],this,this._validate),void 0!==this.options[s]&&void 0===this.options.messages[s]&&(-1!==Ember.$.inArray(s,Object.keys(this.CHECKS))&&(this.options.count=this.options[s]),this.options.messages[s]=Ember.Validations.messages.render(s,this.options),void 0!==this.options.count&&delete this.options.count)},CHECKS:{equalTo:"===",greaterThan:">",greaterThanOrEqualTo:">=",lessThan:"<",lessThanOrEqualTo:"<="},call:function(){var t,i,s,e;if(Ember.isEmpty(this.model.get(this.property)))void 0===this.options.allowBlank&&this.errors.pushObject(this.options.messages.numericality);else if(Ember.Validations.patterns.numericality.test(this.model.get(this.property)))if(this.options.onlyInteger!==!0||/^[+\-]?\d+$/.test(this.model.get(this.property)))if(this.options.odd&&parseInt(this.model.get(this.property),10)%2===0)this.errors.pushObject(this.options.messages.odd);else if(this.options.even&&parseInt(this.model.get(this.property),10)%2!==0)this.errors.pushObject(this.options.messages.even);else for(t in this.CHECKS)e=this.CHECKS[t],void 0!==this.options[t]&&(!isNaN(parseFloat(this.options[t]))&&isFinite(this.options[t])?i=this.options[t]:void 0!==this.model.get(this.options[t])&&(i=this.model.get(this.options[t])),s=new Function("return "+this.model.get(this.property)+" "+e+" "+i),s()||this.errors.pushObject(this.options.messages[t]));else this.errors.pushObject(this.options.messages.onlyInteger);else this.errors.pushObject(this.options.messages.numericality)}})}(),function(){Ember.Validations.validators.local.Presence=Ember.Validations.validators.Base.extend({init:function(){this._super(),this.options===!0&&(this.options={}),void 0===this.options.message&&(this.options.message=Ember.Validations.messages.render("blank",this.options))},call:function(){Ember.isEmpty(this.model.get(this.property))&&this.errors.pushObject(this.options.message)}})}(),function(){Ember.ControllerMixin.reopen({childControllers:Ember.A(),setupAsChildController:function(){this.parentController&&(this.parentController.childControllers.pushObject(this),this.reopen({willDestroy:function(){this._super(),this.parentController.childControllers.removeObject(this)}}))}.on("init")})}(),"undefined"==typeof location||"localhost"!==location.hostname&&"127.0.0.1"!==location.hostname||Ember.Logger.warn("You are running a production build of Ember on localhost and won't receive detailed error messages. If you want full error messages please use the non-minified build provided on the Ember website.");